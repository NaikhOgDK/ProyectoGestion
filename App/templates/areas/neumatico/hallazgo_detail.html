{% extends 'base.html' %}
{% block content %}
<h1>{{ hallazgo }}</h1>
<p>Fecha de inspecci贸n: {{ hallazgo.fecha_inspeccion }}</p>
<p>Tipo: {{ hallazgo.tipo_hallazgo }}</p>
<p>Estado: {{ hallazgo.estado_cierre }}</p>

{% if hallazgo.estado_cierre == 'Abierto' %}
<form method="post" action="{% url 'hallazgo_close' hallazgo.pk %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-primary">Cerrar Hallazgo</button>
</form>
{% else %}
<h2>Informaci贸n del Cierre</h2>
<p><strong>Descripci贸n del Cierre:</strong> {{ hallazgo.descripcion_cierre }}</p>
{% if hallazgo.evidencia_cierre %}
<p><strong>Evidencia del Cierre:</strong> <a href="{{ hallazgo.evidencia_cierre.url }}" target="_blank">Ver Evidencia</a></p>
{% endif %}
{% if hallazgo.documento_cierre %}
<p><strong>Documento de Cierre:</strong> <a href="{{ hallazgo.documento_cierre.url }}" target="_blank">Ver Documento</a></p>
{% endif %}
<form method="post" action="{% url 'hallazgo_close' hallazgo.pk %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-warning">Reabrir Hallazgo</button>
</form>
{% endif %}

<h2>Comunicaciones</h2>
<ul>
    {% for comunicacion in hallazgo.comunicacionhallazgo_set.all %}
    <li>
        <strong>{{ comunicacion.usuario.username }}</strong> ({{ comunicacion.fecha_envio }}): 
        {{ comunicacion.mensaje }}
        {% if comunicacion.evidencia_adicional %}
        <a href="{{ comunicacion.evidencia_adicional.url }}" target="_blank">Ver Evidencia</a>
        {% endif %}
    </li>
    {% empty %}
    <li>No hay comunicaciones para este hallazgo.</li>
    {% endfor %}
</ul>

<a href="{% url 'add_comunicacion' hallazgo.pk %}" class="btn btn-secondary">Agregar Comunicaci贸n</a>
{% endblock %}
